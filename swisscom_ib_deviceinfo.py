# -*- coding: utf-8 -*-
# USE AT YOUR OWN RISK | BENUTZUNG AUF EIGENE VERANTWORUNG
#
# Dieses Programm fragt verschiedene Informationen von der Internetbox ab. Unter anderem:
# - Hersteller
# - Modellname
# - Beschreibung
# - Seriennummer
# - Hardwareversion
# - Softwareversion
# - Uptime
# - MAC-Adresse
# - Telefonnummer(n)
#
# Die Funktion, die von diesem Programm (aus)genutzt wird, f√§llt *NICHT* in den Bereich des Bug Bounty Programmes der Swisscom
#
#
# Author: Mauro Sbicego

#!/usr/bin/env python3
import requests
import urllib
import json
from datetime import datetime, timedelta

payload =  '{"parameters":{}}'
headers = {'Content-Type': 'application/x-sah-ws-4-call+json', 'X-Requested-With': 'XMLHttpRequest', 'Content-Length': '17', 'User-Agent': 'Mozilla/5.0', 'Accept': '*/*', 'Accept-Language':'en-US,en;q=0.5', 'Host':'192.168.1.1', 'Referer': 'http://192.168.1.1/'}

def listtrunks():
    ltr = requests.post('http://192.168.1.1/sysbus/VoiceService/VoiceApplication:listTrunks', data=payload, headers=headers).json()
    trunklines = ltr['status'][0]['trunk_lines']
    trunks = []
    for i in range(len(trunklines)):
            if trunklines[i]['status'] == "Up":
                trunks.append(trunklines[i]['groupId'])
            else:
                break
    for i in range(len(trunks)):
            print("Phone Number: " + trunks[i] + "\n")
            
            

r = requests.post('http://192.168.1.1/sysbus/DeviceInfo:get', data=payload, headers=headers).json()
status = r['status']

for key in status:
	if str(key) == "UpTime":
            sec = timedelta(seconds=int(status[key]))
            d = datetime(1,1,1) + sec
            time = "%d:%d:%d:%d" % (d.day-1, d.hour, d.minute, d.second)
            print(str(key) + ": " + str(status[key]) + " = " + "%d Days %d Hours %d Minutes %d Seconds" % (d.day-1, d.hour, d.minute, d.second))
	else:
	    print(str(key) + ": " + str(status[key]))
	
listtrunks()



